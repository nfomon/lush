// Copyright (C) 2013 Michael Biggs.  See the COPYING file at the top-level
// directory of this distribution and at http://shok.io/code/copyright.html

#ifndef _CodeState_h_
#define _CodeState_h_

/* CodeState wraps some module-type global state that's used for code
 * generation.
 */

#include "util/Log.h"

#include "llvm/ExecutionEngine/ExecutionEngine.h"
#include "llvm/IR/IRBuilder.h"
#include "llvm/IR/Module.h"
#include "llvm/PassManager.h"

namespace compiler {

class CodeState {
public:
  CodeState(Log&);

protected:

private:
  Log& m_log;
  llvm::Module* m_module;    // owned by m_engine
  std::auto_ptr<llvm::ExecutionEngine> m_engine;
  std::auto_ptr<llvm::FunctionPassManager> m_fpm;
  std::auto_ptr<llvm::IRBuilder<> > m_builder;
};

}

#endif // _CodeState_h_
